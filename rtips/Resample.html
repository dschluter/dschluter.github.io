<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="" />


<title>Resampling methods</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>




<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="dolph.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><b>R tips</b> &mdash; Dolph Schluter, University of British Columbia</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R tips pages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="index.html">R tips home</a>
    </li>
    <li>
      <a href="Calculate.html">Calculate with R</a>
    </li>
    <li>
      <a href="Data.html">Data sets</a>
    </li>
    <li>
      <a href="Display.html">Graphs &amp; Tables</a>
    </li>
    <li>
      <a href="Plan.html">Planning tools</a>
    </li>
    <li>
      <a href="Loop.html">Loop, repeat</a>
    </li>
    <li>
      <a href="Model.html">Fit model</a>
    </li>
    <li>
      <a href="Prob.html">Probability &amp; Likelihood</a>
    </li>
    <li>
      <a href="Resample.html">Resample, Bootstrap</a>
    </li>
    <li>
      <a href="Meta.html">Meta-analysis</a>
    </li>
    <li>
      <a href="Multivariate.html">Multivariate methods</a>
    </li>
    <li>
      <a href="Phylogenetic.html">Phylogenetic comparison</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://www.zoology.ubc.ca/~bio501/R/workshops/">R workshops home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Resampling methods</h1>

</div>


<p>This page provides tips on how to carry out bootstrapping and permutation tests in R by resampling data.</p>
<hr />
<div id="bootstrap-resampling" class="section level2">
<h2>Bootstrap resampling</h2>
<p>The bootstrap is mainly used in <b>estimation</b>. The method uses resampling with replacement to generates an approximate sampling distribution of an estimate. Standard errors and confidence intervals can be calculated using this bootstrap sampling distribution.</p>
<p><br></p>
<div id="resample-data" class="section level3">
<h3>Resample data</h3>
Let’s assume that the data are a sample of measurements for a <u>single variable</u> stored in a vector <code>x</code>. The data may be numeric or categorical.
<ol>
<li>
<p>A single bootstrap replicate is obtained as follows. The replace option is used to indicate that sampling is carried out <b>with replacement</b>.</p>
<pre class="r"><code>xboot &lt;- sample(x, replace = TRUE)</code></pre>
</li>
<li>
<p>Calculate the statistic of interest (for example, the mean) on the resampled data in <code>xboot</code> and store the result in a vector created for this purpose.</p>
<pre class="r"><code>z &lt;- vector()        # initialize z (do only once)
z[1] &lt;- mean(xboot)  # first bootstrap replicate estimate</code></pre>
</li>
<li>
Repeat steps (1) and (2) many times. The result will be a large collection of bootstrap replicate estimates for subsequent analysis.
</li>
</ol>
In other cases, <u>two or more variables</u> are measured on individuals (e.g., stem height, leaf area, petal diameter, etc). Assume that each row of a data frame <code>mydata</code> is a different individual, and each column a different variable.
<ol>
<li>
<p>To resample individuals (i.e., rows),</p>
<pre class="r"><code>iboot &lt;- sample(1:nrow(mydata), replace = TRUE))
bootdata &lt;- mydata[iboot,]</code></pre>
The data frame <code>bootdata</code> will contain a single bootstrap replicate including all the variables.
</li>
<li>
<p>Calculate the statistic of interest on the resampled data and store the result in vector created for this purpose. For example, to calculate the correlation between two variables x and y in <code>bootdata</code>,</p>
<pre class="r"><code>z &lt;- vector()        # initialize z (do only once)
z[1] &lt;- cor(bootdata$x, bootdata$y) </code></pre>
</li>
<li>
Repeat steps (1) and (2) many times. The result will be a large collection of bootstrap replicate estimates for subsequent analysis.
</li>
</ol>
<p><br></p>
</div>
<div id="bootstrap-standard-error" class="section level3">
<h3>Bootstrap standard error</h3>
<p>Assume that the vector <code>z</code> contains a large number of bootstrap replicate estimates of a statistic of interest. The bootstrap standard error of the statistic is obtained as the <b>standard deviation</b> of the bootstrap replicate estimates. (The most common mistake at this stage is to calculate the standard error of the bootstrap replicates rather than the standard deviation.)</p>
<pre class="r"><code>sd(z)</code></pre>
<p><br></p>
</div>
<div id="confidence-interval-approximation-using-the-percentile-method" class="section level3">
<h3>Confidence interval approximation using the percentile method</h3>
<p>The percentile method is often used to provide an approximate 95% confidence interval for the population parameter. The percentile method is not as accurate as the BC<sub>a</sub> method, but it is very quick and easy to calculate. Assume that the vector <code>z</code> contains a large number of bootstrap replicate estimates of the statistic of interest. By the percentile method, a 95% boostrap confidence interval for the parameter is obtained as</p>
<pre class="r"><code>quantile(z, probs = c(0.025,0.975))</code></pre>
<p>A large number of bootstrap replicate estimates is required for an accurate confidence interval.</p>
<p><br></p>
</div>
<div id="bootstrap-estimate-of-bias" class="section level3">
<h3>Bootstrap estimate of bias</h3>
<p>The bootstrap is often used to determine the bias of an estimate. Assume that the vector <code>z</code> contains a large number of bootstrap replicate estimates of a statistic of interest. Also, assume that the same statistic computed on the original data is stored in an object named “estimate”. The bootstrap estimate of bias is calculated as</p>
<pre class="r"><code>mean(z) - estimate</code></pre>
<hr />
</div>
</div>
<div id="using-the-boot-package" class="section level2">
<h2>Using the boot package</h2>
<p>The boot library, included with the standard R installation, includes useful commands for bootstrapping. Notably, it will calculate confidence intervals using the BC<sub>a</sub> method, which is more accurate than those produced by the percentile method. BC<sub>a</sub> stands for “bias corrected and accelerated”. The method corrects for estimated bias and skewness. Consult Efron and Tibshirani (1998) for details.</p>
<p>To begin, load the boot library</p>
<pre class="r"><code>library(boot)</code></pre>
<p><br></p>
<div id="single-variable" class="section level3">
<h3>Single variable</h3>
<p>To use the boot package you will need to write a function to calculate the statistic of interest. The format is illustrated below for the sample mean, but any univariate function would be handled similarly. We’ll call our function “boot.mean”. When you have finished writing the script for a function you will need to cut and paste it into the command window so that R can access it (you’ll need to do this just once in an R session). Here, <code>x</code> refers to the vector of data. <code>i</code> serves as a counter, as in your own <code>for</code> loop, but it must be included as an argument in your function as shown.</p>
<pre class="r"><code>boot.mean &lt;- function(x,i){boot.mean &lt;- mean(x[i])}</code></pre>
<p>The command <code>boot</code> will automatically carry out all the resampling and computations required. For this example, <code>x</code> is the vector of original data and <code>boot.mean</code> is the name of the function we created above to calculate the statistic of interest. R specifies the number of bootstrap replicate estimates desired.</p>
<pre class="r"><code>z &lt;- boot(x, boot.mean, R = 2000)</code></pre>
<p>The resulting object (which here named <code>z</code>) is a <b>boot</b> object containing all the results. Use the following additional commands to pull out the results.</p>
<pre class="r"><code>print(z)                  # Bootstrap calculation of bias and SE
sd(z$t)                   # Another way to get the standard error

hist(z$t)                 # Histogram of boostrap replicate estimates
qqnorm(z$t)               # Normal quantiles of replicate estimates

boot.ci(z, type = &quot;bca&quot;)  # 95% confidence interval using BCa
boot.ci(z, type = &quot;perc&quot;) # Same using percentile method</code></pre>
<p><br></p>
</div>
<div id="two-or-more-variables" class="section level3">
<h3>Two or more variables</h3>
<p>Here’s how you would use the boot command If the statistic of interest must be calculated from two (or more) variables (for example, a correlation, regression slope, or odds ratio). Assume that there are two variables of interest, <code>x</code> and <code>y</code>. If not done already, put the two variables into a data frame (here called <code>mydata</code>),</p>
<pre class="r"><code>mydata &lt;- cbind.data.frame(x, y, stringsAsFactors = FALSE)</code></pre>
<p>Then create a function to calculate the statistic of interest on the variables in <code>mydata</code>. For example, to create a function that calculates the correlation coefficient between the two variables <code>x</code> and <code>y</code>, use</p>
<pre class="r"><code>boot.cor &lt;- function(mydata,i){
  x &lt;- mydata$x[i]
  y &lt;- mydata$y[i]
  boot.cor &lt;- cor(x,y)
  }</code></pre>
<p>Here, <code>i</code> refers to a vector of indices, which must be included as an argument in the function and employed as shown.</p>
<p>Finally, pass your data frame and function to the boot command,</p>
<pre class="r"><code>z &lt;- boot(mydata, boot.cor, R = 2000)</code></pre>
<p>See the previous section for a list of commands to pull results from the boot object (here named <code>z</code>).</p>
<hr />
</div>
</div>
<div id="permutation-test" class="section level2">
<h2>Permutation test</h2>
<p>A permutation test uses resampling and the computer to generate a null distribution for a test statistic. The test statistic is a measure of association between two variables or difference between groups, such as a slope, a correlation, or an odds ratio. Each permutation step involves randomly resampling <b>without replacement</b> the values of one of the two variables in the data and recalculating the test statistic in each permutation. The two variables may be categorical (character or factor), numeric, or one of each.</p>
<p><br></p>
<div id="both-variables-categorical" class="section level3">
<h3>Both variables categorical</h3>
<p>R has a built-in permutation procedure for a contingency test of association when both of two variables are categorical (call them A1 and A2). To apply it, execute the usual command for the <i>χ</i><sup>2</sup> contingency test, but set the <code>simulate.p.value</code> option to TRUE. The number of replicates in the permutation is set by the option <code>B</code> (default is 2000). Each permutation rearranges the values in the contingency table while keeping all the row and column totals fixed to their observed values.</p>
<pre class="r"><code>chisq.test(A1, A2, simulate.p.value = TRUE, B = 5000)</code></pre>
<p><br></p>
</div>
<div id="data-are-numeric" class="section level3">
<h3>Data are numeric</h3>
If one or both of the variables is numeric, then you will need to create a short loop to carry out the resampling necessary for the permutation test. Choose one of the two variables to resample (call it <code>x</code>). It doesn’t matter which of the two variables you choose. Keep the other variable (call it <code>y</code>) unchanged (there is no benefit to resampling both variables).
<ol>
<li>
<p>Resample <code>x</code> without replacement to create a new vector (call it x1).</p>
<pre class="r"><code>x1 &lt;- sample(x, replace = FALSE)</code></pre>
</li>
<li>
<p>Calculate the test statistic to measure association between <code>y</code> and the randomized variable x1. Store the result in a vector created for this purpose. For example, to calculate the correlation between the two variables,</p>
<pre class="r"><code>z &lt;- vector()        # initialize z (do only once)
z[1] &lt;- cor(x1, y)   # first permutation result</code></pre>
</li>
<li>
Repeat steps (1) and (2) many times. The result will be a large collection of replicates representing the null distribution of your test statistic.
</li>
</ol>
</div>
</div>

&nbsp;
<hr />
<p style="text-align: left;">
&copy; 2009-2020 Dolph Schluter
</p>
&nbsp;


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
